# æŒä¹…åŒ–å¤šè½®æµ‹è¯•å·¥å…·ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

`test_persistent_multi_round.py` æ˜¯ä¸€ä¸ªæ–°çš„æŒä¹…åŒ–å¤šè½®äº¤æ˜“æµ‹è¯•å·¥å…·ï¼Œä¸ç°æœ‰æµ‹è¯•çš„ä¸»è¦åŒºåˆ«ï¼š

### ä¸ç°æœ‰æµ‹è¯•çš„åŒºåˆ«

| ç‰¹æ€§ | ç°æœ‰æµ‹è¯• (run_multi_round_test.py) | æŒä¹…åŒ–æµ‹è¯• (test_persistent_multi_round.py) |
|------|-----------------------------------|--------------------------------------------|
| å­˜å‚¨æ–¹å¼ | ä¸´æ—¶å­˜å‚¨ï¼Œæµ‹è¯•ç»“æŸååˆ é™¤ | âœ… æ°¸ä¹…å­˜å‚¨ï¼Œæ•°æ®ä¿ç•™ |
| ä¸­æ–­æ¢å¤ | ä¸æ”¯æŒï¼Œä¸­æ–­åéœ€ä»å¤´å¼€å§‹ | âœ… æ”¯æŒä¸­æ–­åç»§ç»­è¿è¡Œ |
| å¤šæ¬¡è¿è¡Œ | æ¯æ¬¡éƒ½æ˜¯å…¨æ–°æµ‹è¯• | âœ… å¯ä»¥ç´¯ç§¯è¿è¡Œè½®æ¬¡ |
| çŠ¶æ€ç®¡ç† | æ—  | âœ… JSONæ–‡ä»¶ä¿å­˜æµ‹è¯•çŠ¶æ€ |
| æ•°æ®æ¸…ç† | tearDownè‡ªåŠ¨æ¸…ç† | ä¸è‡ªåŠ¨æ¸…ç†ï¼Œæ‰‹åŠ¨æ§åˆ¶ |
| å­˜å‚¨ä½ç½® | ä¸´æ—¶ç›®å½• | `EZ_Test/persistent_test_data/` |

## æ ¸å¿ƒç‰¹æ€§

### 1. æŒä¹…åŒ–å­˜å‚¨
- æµ‹è¯•æ•°æ®å­˜å‚¨åœ¨ `EZ_Test/persistent_test_data/` ç›®å½•ä¸‹
- åŒºå—é“¾æ•°æ®æ°¸ä¹…ä¿å­˜åœ¨ `EZ_Test/persistent_test_data/blockchain/`
- è´¦æˆ·æ•°æ®æ°¸ä¹…ä¿å­˜åœ¨ `EZ_Test/persistent_test_data/accounts/`
- äº¤æ˜“æ± æ•°æ®æ°¸ä¹…ä¿å­˜åœ¨ `EZ_Test/persistent_test_data/tx_pool.db`
- æµ‹è¯•çŠ¶æ€ä¿å­˜åœ¨ `EZ_Test/persistent_test_data/persistent_test_state.json`
- âœ… å·²åŠ å…¥ `.gitignore`ï¼Œä¸ä¼šæäº¤åˆ° git ä»“åº“

### 2. ä¸­æ–­æ¢å¤
- æµ‹è¯•è¿‡ç¨‹ä¸­æ–­ï¼ˆCtrl+C æˆ–å¼‚å¸¸ï¼‰æ—¶è‡ªåŠ¨ä¿å­˜å½“å‰è¿›åº¦
- ä¸‹æ¬¡è¿è¡Œè‡ªåŠ¨ä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹ç»§ç»­
- ä¸ä¸¢å¤±å·²å®Œæˆçš„æµ‹è¯•è½®æ¬¡

### 3. ç´¯ç§¯è¿è¡Œ
- å¯ä»¥å¤šæ¬¡è¿è¡Œï¼Œç´¯ç§¯æµ‹è¯•è½®æ¬¡
- ç¬¬ä¸€æ¬¡è¿è¡Œ10è½®ï¼Œç¬¬äºŒæ¬¡å†è¿è¡Œ10è½®ï¼Œæ€»å…±20è½®
- é€‚åˆé•¿æ—¶é—´çš„ç¨³å®šæ€§æµ‹è¯•

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

```bash
# è¿è¡Œé»˜è®¤æµ‹è¯• (20è½®)
python EZ_Test/run_persistent_test.py

# æˆ–ç›´æ¥è¿è¡Œä¸»æ–‡ä»¶
python EZ_Test/test_persistent_multi_round.py
```

### é«˜çº§é€‰é¡¹

```bash
# è®¾ç½®ç›®æ ‡è½®æ¬¡ä¸º50è½®
python EZ_Test/run_persistent_test.py --rounds 50

# é‡ç½®æµ‹è¯•çŠ¶æ€ï¼Œä»å¤´å¼€å§‹
python EZ_Test/run_persistent_test.py --reset

# è‡ªå®šä¹‰å­˜å‚¨ç›®å½•ï¼ˆè¦†ç›–é»˜è®¤çš„ EZ_Test/persistent_test_data/ï¼‰
python EZ_Test/run_persistent_test.py --storage-dir my_custom_test_data

# ç»„åˆä½¿ç”¨
python EZ_Test/run_persistent_test.py --rounds 100 --storage-dir long_term_test
```

### ä¸­æ–­åç»§ç»­

```bash
# ç¬¬ä¸€æ¬¡è¿è¡Œ (å‡è®¾è¿è¡Œåˆ°ç¬¬5è½®è¢«ä¸­æ–­)
python EZ_Test/run_persistent_test.py --rounds 20

# ç¬¬äºŒæ¬¡è¿è¡Œ (ä¼šä»ç¬¬6è½®ç»§ç»­ï¼Œç›´åˆ°å®Œæˆ20è½®)
python EZ_Test/run_persistent_test.py --rounds 20

# å¦‚æœæƒ³å¢åŠ ç›®æ ‡è½®æ¬¡åˆ°50ï¼Œä¼šä»ç¬¬6è½®ç»§ç»­åˆ°50è½®
python EZ_Test/run_persistent_test.py --rounds 50
```

## æµ‹è¯•çŠ¶æ€æ–‡ä»¶

`EZ_Test/persistent_test_data/persistent_test_state.json` æ–‡ä»¶å†…å®¹ç¤ºä¾‹ï¼š

```json
{
  "current_round": 5,
  "target_rounds": 20,
  "initialized": true,
  "accounts": [
    {
      "name": "alice",
      "address": "0x...",
      "private_key_pem": "...",
      "public_key_pem": "..."
    },
    ...
  ],
  "last_update": "2025-12-31T10:30:45",
  "blockchain_data_dir": "EZ_Test/persistent_test_data/blockchain",
  "pool_db_path": "EZ_Test/persistent_test_data/tx_pool.db",
  "account_storage_dir": "EZ_Test/persistent_test_data/accounts"
}
```

## æ•°æ®æ¸…ç†

### æ‰‹åŠ¨æ¸…ç†æµ‹è¯•æ•°æ®

```bash
# åˆ é™¤æ•´ä¸ªæµ‹è¯•ç›®å½•
rm -rf EZ_Test/persistent_test_data

# æˆ–ä½¿ç”¨å·¥å…·é‡ç½®
python EZ_Test/run_persistent_test.py --reset
```

### éƒ¨åˆ†æ¸…ç†

```bash
# åªé‡ç½®çŠ¶æ€ï¼Œä¿ç•™æ•°æ®
# ç¼–è¾‘ EZ_Test/persistent_test_data/persistent_test_state.jsonï¼Œå°† current_round è®¾ä¸º 0

# åˆ é™¤åŒºå—é“¾æ•°æ®ä½†ä¿ç•™è´¦æˆ·
rm -rf EZ_Test/persistent_test_data/blockchain
```

## æµ‹è¯•è¾“å‡ºç¤ºä¾‹

```
============================================================
ğŸš€ æŒä¹…åŒ–å¤šè½®æµ‹è¯•åˆå§‹åŒ–
============================================================
ğŸ“‚ æ£€æµ‹åˆ°å·²æœ‰è¿›åº¦: ç¬¬ 5/20 è½®
ğŸ’¾ å°†ä»ç¬¬ 6 è½®ç»§ç»­è¿è¡Œ...
------------------------------------------------------------
ğŸ“‚ åŠ è½½å·²æœ‰æµ‹è¯•ç¯å¢ƒ...
ğŸ‘¤ åŠ è½½è´¦æˆ·...
âœ… åŠ è½½ 4 ä¸ªè´¦æˆ·
âœ… æµ‹è¯•ç¯å¢ƒåŠ è½½å®Œæˆ | åŒºå—é«˜åº¦: 5

============================================================
ğŸ¯ å¼€å§‹å¤šè½®æµ‹è¯• | è½®æ¬¡: 5-20
============================================================

============================================================
ğŸ”„ ç¬¬ 6/20 è½®
============================================================
ğŸ“ åˆ›å»ºäº¤æ˜“... | 3è½® 7ç¬”
âš¡ åˆ›å»ºäº¤æ˜“... | 3ä¸ªäº¤æ˜“åŒ…
ğŸ“¥ æäº¤äº¤æ˜“æ± ... | 3/3 æˆåŠŸ
â›ï¸  æ‰“åŒ…åŒºå—... | åŒºå—#6 | 3äº¤æ˜“
ğŸ”— æ·»åŠ åŒºå—... | ä¸»é“¾
ğŸ”„ æ›´æ–°VPB...
   å‘é€è€…æ›´æ–°: 3/3
   æ¥æ”¶è€…æ›´æ–°: 7ä¸ªvalue | éªŒè¯:7 | æ¥æ”¶:7
âœ… éªŒè¯çŠ¶æ€... | é€šè¿‡

ğŸ“Š å½“å‰è¿›åº¦: 6/20 è½® (30.0%)
ğŸ’° æ€»ä½™é¢: 10000 | alice:2500(U:5,C:5) | bob:2500(U:5,C:5) | charlie:2500(U:5,C:5) | david:2500(U:5,C:5)
âš¡ Checkpointä½¿ç”¨ç‡: 15.2% (3/20)
```

## é€‚ç”¨åœºæ™¯

### é€‚åˆä½¿ç”¨æŒä¹…åŒ–æµ‹è¯•çš„åœºæ™¯

1. **é•¿æ—¶é—´ç¨³å®šæ€§æµ‹è¯•**
   - è¿è¡Œ100è½®ã€1000è½®ç”šè‡³æ›´å¤šè½®æ¬¡
   - æµ‹è¯•ç³»ç»Ÿåœ¨é•¿æ—¶é—´è¿è¡Œä¸‹çš„ç¨³å®šæ€§

2. **æ–­ç‚¹ç»­ä¼ æµ‹è¯•**
   - åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œéšæ—¶å¯ä»¥ä¸­æ–­
   - ä¸æµªè´¹å·²å®Œæˆçš„æµ‹è¯•è¿›åº¦

3. **è°ƒè¯•å’Œåˆ†æ**
   - ä¿ç•™æµ‹è¯•æ•°æ®ä¾›åç»­åˆ†æ
   - å¯ä»¥æ£€æŸ¥ç‰¹å®šè½®æ¬¡çš„çŠ¶æ€

4. **è¿ç»­é›†æˆ**
   - åˆ†æ‰¹æ¬¡è¿è¡Œå¤§é‡æµ‹è¯•
   - æ¯æ¬¡è¿è¡Œä¸€å®šè½®æ¬¡ï¼Œç´¯ç§¯å®Œæˆ

### ä¸é€‚åˆçš„åœºæ™¯

1. **å¿«é€Ÿå¼€å‘æµ‹è¯•**
   - éœ€è¦é¢‘ç¹ä¿®æ”¹ä»£ç 
   - æ¯æ¬¡æµ‹è¯•éƒ½éœ€è¦å¹²å‡€ç¯å¢ƒ
   - å»ºè®®ä½¿ç”¨ç°æœ‰çš„ `run_multi_round_test.py`

2. **éš”ç¦»æ€§æµ‹è¯•**
   - éœ€è¦ç¡®ä¿æ¯æ¬¡æµ‹è¯•äº’ä¸å½±å“
   - å»ºè®®ä½¿ç”¨ä¸´æ—¶å­˜å‚¨çš„æµ‹è¯•

## ä¸ç°æœ‰æµ‹è¯•çš„å¯¹æ¯”

### ç°æœ‰æµ‹è¯• (run_multi_round_test.py)

- âœ… å¿«é€Ÿã€è½»é‡
- âœ… æ¯æ¬¡éƒ½æ˜¯å…¨æ–°ç¯å¢ƒ
- âœ… é€‚åˆå¼€å‘å’Œè°ƒè¯•
- âŒ ä¸­æ–­åéœ€ä»å¤´å¼€å§‹
- âŒ æ— æ³•ä¿ç•™æµ‹è¯•æ•°æ®

### æŒä¹…åŒ–æµ‹è¯• (test_persistent_multi_round.py)

- âœ… æ”¯æŒä¸­æ–­æ¢å¤
- âœ… ä¿ç•™æµ‹è¯•æ•°æ®
- âœ… é€‚åˆé•¿æœŸæµ‹è¯•
- âŒ éœ€è¦æ‰‹åŠ¨æ¸…ç†æ•°æ®
- âŒ å ç”¨æ›´å¤šç£ç›˜ç©ºé—´

## æ³¨æ„äº‹é¡¹

1. **ç£ç›˜ç©ºé—´**
   - é•¿æ—¶é—´è¿è¡Œä¼šå ç”¨è¾ƒå¤šç£ç›˜ç©ºé—´
   - å®šæœŸæ£€æŸ¥ `EZ_Test/persistent_test_data` ç›®å½•å¤§å°
   - å¿…è¦æ—¶è¿›è¡Œæ¸…ç†

2. **çŠ¶æ€ä¸€è‡´æ€§**
   - ä¸è¦æ‰‹åŠ¨ä¿®æ”¹ `EZ_Test/persistent_test_data/persistent_test_state.json`
   - å¦‚éœ€é‡ç½®ï¼Œä½¿ç”¨ `--reset` é€‰é¡¹

3. **å¹¶å‘è¿è¡Œ**
   - ä¸è¦åŒæ—¶è¿è¡Œå¤šä¸ªä½¿ç”¨ç›¸åŒå­˜å‚¨ç›®å½•çš„å®ä¾‹
   - å¦‚éœ€å¹¶è¡Œæµ‹è¯•ï¼Œä½¿ç”¨ä¸åŒçš„ `--storage-dir`

4. **ä»£ç å˜æ›´**
   - å¦‚æœä»£ç ç»“æ„å‘ç”Ÿå˜åŒ–ï¼ˆå¦‚Accountã€Blockchainç­‰ï¼‰
   - å»ºè®®ä½¿ç”¨ `--reset` é‡ç½®æµ‹è¯•
   - é¿å…æ–°æ—§æ•°æ®ç»“æ„ä¸å…¼å®¹

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šåŠ è½½å¤±è´¥

```
âŒ å­˜å‚¨ç›®å½•ä¸å®Œæ•´ï¼Œéœ€è¦é‡æ–°åˆå§‹åŒ–
```

**è§£å†³æ–¹æ³•**ï¼šä½¿ç”¨ `--reset` é‡ç½®æµ‹è¯•

### é—®é¢˜ï¼šè´¦æˆ·éªŒè¯å¤±è´¥

```
âŒ Account xxx å®Œæ•´æ€§éªŒè¯å¤±è´¥
```

**è§£å†³æ–¹æ³•**ï¼š
1. ä½¿ç”¨ `--reset` é‡ç½®æµ‹è¯•
2. æˆ–æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–è¿›ç¨‹åœ¨ä¿®æ”¹æ•°æ®

### é—®é¢˜ï¼šCheckpointä½¿ç”¨ç‡å¼‚å¸¸

```
âš¡ Checkpointä½¿ç”¨ç‡: 0.0% (0/100)
```

**è¯´æ˜**ï¼šè¿™å¯èƒ½æ˜¯æ­£å¸¸çš„ï¼Œå–å†³äºvalueçš„çŠ¶æ€è½¬æ¢é€»è¾‘

## æ‰©å±•å¼€å‘

å¦‚éœ€æ‰©å±•åŠŸèƒ½ï¼Œå¯ä»¥ä¿®æ”¹ä»¥ä¸‹éƒ¨åˆ†ï¼š

1. **æ·»åŠ æ›´å¤šç»Ÿè®¡ä¿¡æ¯**
   - åœ¨ `_print_final_statistics()` ä¸­æ·»åŠ 

2. **è‡ªå®šä¹‰äº¤æ˜“ç”Ÿæˆç­–ç•¥**
   - ä¿®æ”¹ `_create_transaction_requests()` æ–¹æ³•

3. **æ·»åŠ å®šæœŸæ£€æŸ¥ç‚¹**
   - åœ¨ `run_rounds()` ä¸­å®šæœŸä¿å­˜çŠ¶æ€

4. **æ”¯æŒå¤šè´¦æˆ·é…ç½®**
   - ä¿®æ”¹ `_create_accounts()` æ–¹æ³•

## æ€»ç»“

æŒä¹…åŒ–å¤šè½®æµ‹è¯•å·¥å…·æ˜¯ä¸€ä¸ªå¼ºå¤§çš„é•¿æœŸæµ‹è¯•å·¥å…·ï¼Œç‰¹åˆ«é€‚åˆï¼š
- ç¨³å®šæ€§æµ‹è¯•
- æ–­ç‚¹ç»­ä¼ æµ‹è¯•
- æ•°æ®ä¿ç•™åˆ†æ

ä¸ç°æœ‰çš„å¿«é€Ÿæµ‹è¯•å·¥å…·é…åˆä½¿ç”¨ï¼Œè¦†ç›–ä¸åŒçš„æµ‹è¯•éœ€æ±‚ã€‚
